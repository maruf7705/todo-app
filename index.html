<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TaskFlow Pro | Productivity App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            500: '#6366f1',
                            600: '#4f46e5',
                        },
                        secondary: {
                            500: '#f43f5e',
                            600: '#e11d48',
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style>
        /* Custom styles that can't be done with Tailwind */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        .task-item {
            transition: transform 0.2s ease, opacity 0.2s ease;
        }
        
        .task-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
        }
        
        @media (max-width: 640px) {
            .glass-effect {
                backdrop-filter: blur(4px);
                -webkit-backdrop-filter: blur(4px);
            }
        }
        
        /* Smooth transitions for modals */
        .modal-enter {
            opacity: 0;
            transform: scale(0.95);
        }
        
        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 200ms, transform 200ms;
        }
        
        .modal-exit {
            opacity: 1;
        }
        
        .modal-exit-active {
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 200ms, transform 200ms;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-indigo-50 to-purple-50 min-h-screen text-gray-800">
    <!-- App Container -->
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="flex flex-col sm:flex-row justify-between items-center mb-8 gap-4">
            <div class="flex items-center">
                <div class="w-10 h-10 rounded-lg bg-indigo-500 flex items-center justify-center shadow-md">
                    <i class="fas fa-tasks text-white text-lg"></i>
                </div>
                <h1 class="ml-3 text-2xl font-bold text-gray-800">TaskFlow Pro</h1>
            </div>
            
            <div class="flex items-center space-x-3">
                <!-- Auth Buttons -->
                <button id="loginBtn" class="px-4 py-2 rounded-lg border border-indigo-500 text-indigo-500 hover:bg-indigo-50 transition-colors">
                    <i class="fas fa-sign-in-alt mr-2"></i>Login
                </button>
                <button id="signupBtn" class="px-4 py-2 rounded-lg bg-indigo-500 text-white hover:bg-indigo-600 transition-colors shadow-sm">
                    <i class="fas fa-user-plus mr-2"></i>Sign Up
                </button>
                
                <!-- User Profile (hidden by default) -->
                <div id="userProfile" class="hidden items-center">
                    <img id="userAvatar" src="" alt="User" class="w-8 h-8 rounded-full object-cover border-2 border-white shadow">
                    <span id="userName" class="ml-2 font-medium text-sm"></span>
                    <button id="logoutBtn" class="ml-3 text-gray-500 hover:text-gray-700">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column - To-Do List -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Task Input -->
                <div class="glass-effect rounded-xl p-5 shadow-sm border border-white">
                    <div class="flex items-center">
                        <input type="text" id="taskInput" placeholder="What needs to be done?" 
                               class="flex-1 px-4 py-3 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-transparent"
                               aria-label="Add new task">
                        <button id="addTaskBtn" class="ml-3 px-4 py-3 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors shadow-sm">
                            <i class="fas fa-plus"></i>
                        </button>
                    </div>
                </div>
                
                <!-- Task Filters -->
                <div class="glass-effect rounded-xl p-4 shadow-sm border border-white flex justify-between items-center">
                    <div class="flex space-x-2">
                        <button data-filter="all" class="task-filter px-3 py-1 rounded-lg text-sm font-medium bg-indigo-500 text-white">
                            All
                        </button>
                        <button data-filter="active" class="task-filter px-3 py-1 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100">
                            Active
                        </button>
                        <button data-filter="completed" class="task-filter px-3 py-1 rounded-lg text-sm font-medium text-gray-600 hover:bg-gray-100">
                            Completed
                        </button>
                    </div>
                    <button id="clearCompletedBtn" class="text-sm text-gray-500 hover:text-gray-700">
                        Clear completed
                    </button>
                </div>
                
                <!-- Task List -->
                <div id="taskList" class="glass-effect rounded-xl p-4 shadow-sm border border-white space-y-3 min-h-[200px]">
                    <div class="text-center py-10 text-gray-400" id="emptyState">
                        <i class="fas fa-clipboard-list text-4xl mb-3"></i>
                        <p>No tasks yet. Add one above!</p>
                    </div>
                    
                    <!-- Task items will be added here dynamically -->
                </div>
                
                <!-- Task Stats -->
                <div class="glass-effect rounded-xl p-4 shadow-sm border border-white flex justify-between text-sm text-gray-600">
                    <div>
                        <span id="activeCount">0</span> tasks left
                    </div>
                    <div>
                        <span id="completedCount">0</span> completed
                    </div>
                </div>
            </div>
            
            <!-- Right Column - Time Block Tracker -->
            <div class="space-y-6">
                <!-- Time Block Form -->
                <div class="glass-effect rounded-xl p-5 shadow-sm border border-white">
                    <h2 class="text-lg font-semibold mb-4 flex items-center">
                        <i class="fas fa-clock mr-2 text-indigo-500"></i> Time Tracker
                    </h2>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Description</label>
                            <input type="text" id="timeBlockDesc" placeholder="What are you working on?" 
                                   class="w-full px-3 py-2 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-transparent">
                        </div>
                        
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Start Time</label>
                                <input type="time" id="startTime" 
                                       class="w-full px-3 py-2 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-transparent">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">End Time</label>
                                <input type="time" id="endTime" 
                                       class="w-full px-3 py-2 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-transparent">
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Notes (Optional)</label>
                            <textarea id="timeBlockNotes" rows="2" placeholder="Any additional notes..."
                                      class="w-full px-3 py-2 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-transparent"></textarea>
                        </div>
                        
                        <div class="flex justify-between items-center pt-2">
                            <div>
                                <span class="text-sm font-medium">Duration:</span>
                                <span id="durationDisplay" class="ml-2 text-indigo-500 font-medium">0h 0m</span>
                            </div>
                            <button id="addTimeBlockBtn" class="px-4 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors shadow-sm">
                                <i class="fas fa-plus mr-1"></i> Add Block
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Time Blocks List -->
                <div class="glass-effect rounded-xl p-5 shadow-sm border border-white">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-lg font-semibold flex items-center">
                            <i class="fas fa-history mr-2 text-indigo-500"></i> Today's Blocks
                        </h2>
                        <button id="exportBtn" class="text-sm text-indigo-500 hover:text-indigo-700 flex items-center">
                            <i class="fas fa-file-export mr-1"></i> Export
                        </button>
                    </div>
                    
                    <div id="timeBlocksList" class="space-y-3">
                        <div class="text-center py-8 text-gray-400">
                            <i class="fas fa-hourglass-half text-3xl mb-2"></i>
                            <p>No time blocks recorded yet</p>
                        </div>
                        
                        <!-- Time blocks will be added here dynamically -->
                    </div>
                    
                    <div class="mt-4 pt-3 border-t border-gray-100 text-sm text-gray-500">
                        <div class="flex justify-between">
                            <span>Total tracked today:</span>
                            <span id="totalTrackedTime" class="font-medium">0h 0m</span>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Modals -->
    
    <!-- Delete Confirmation Modal -->
    <div id="confirmModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold">Confirm Action</h3>
                <button id="closeModalBtn" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <p id="modalMessage" class="mb-6">Are you sure you want to delete this task?</p>
            <div class="flex justify-end space-x-3">
                <button id="cancelModalBtn" class="px-4 py-2 rounded-lg border border-gray-300 text-gray-700 hover:bg-gray-50">
                    Cancel
                </button>
                <button id="confirmModalBtn" class="px-4 py-2 rounded-lg bg-red-500 text-white hover:bg-red-600">
                    Confirm
                </button>
            </div>
        </div>
    </div>
    
    <!-- Auth Modal -->
    <div id="authModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl p-6 max-w-md w-full mx-4 shadow-xl transform transition-all">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-semibold" id="authModalTitle">Login</h3>
                <button id="closeAuthModalBtn" class="text-gray-400 hover:text-gray-500">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div id="authForm">
                <div class="space-y-4">
                    <div id="nameField" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Name</label>
                        <input type="text" id="authName" placeholder="Your name" 
                               class="w-full px-3 py-2 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" id="authEmail" placeholder="your@email.com" 
                               class="w-full px-3 py-2 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                        <input type="password" id="authPassword" placeholder="••••••••" 
                               class="w-full px-3 py-2 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-transparent">
                        <p class="text-xs text-gray-500 mt-1">Minimum 6 characters</p>
                    </div>
                    
                    <div id="passwordConfirmField" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                        <input type="password" id="authPasswordConfirm" placeholder="••••••••" 
                               class="w-full px-3 py-2 rounded-lg border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-200 focus:border-transparent">
                    </div>
                    
                    <button id="submitAuthBtn" class="w-full py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 transition-colors shadow-sm mt-2">
                        Continue
                    </button>
                    
                    <div class="relative my-4">
                        <div class="absolute inset-0 flex items-center">
                            <div class="w-full border-t border-gray-200"></div>
                        </div>
                        <div class="relative flex justify-center text-sm">
                            <span class="px-2 bg-white text-gray-500">Or continue with</span>
                        </div>
                    </div>
                    
                    <button id="googleAuthBtn" class="w-full py-2 border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-center">
                        <img src="https://www.google.com/favicon.ico" alt="Google" class="w-4 h-4 mr-2">
                        <span>Google</span>
                    </button>
                </div>
                
                <div class="mt-4 text-center text-sm">
                    <span id="authToggleText">Don't have an account? </span>
                    <button id="authToggleBtn" class="text-indigo-500 hover:text-indigo-700 font-medium">Sign up</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notification Toast -->
    <div id="toast" class="fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-3 rounded-lg shadow-lg transform translate-y-10 opacity-0 transition-all duration-300 flex items-start max-w-xs">
        <div class="mr-3">
            <i class="fas fa-check-circle text-green-400"></i>
        </div>
        <div>
            <p id="toastMessage" class="text-sm"></p>
        </div>
        <button id="closeToastBtn" class="ml-4 text-gray-300 hover:text-white">
            <i class="fas fa-times"></i>
        </button>
    </div>
    
    <script>
        // DOM Elements
        const taskInput = document.getElementById('taskInput');
        const addTaskBtn = document.getElementById('addTaskBtn');
        const taskList = document.getElementById('taskList');
        const emptyState = document.getElementById('emptyState');
        const taskFilters = document.querySelectorAll('.task-filter');
        const clearCompletedBtn = document.getElementById('clearCompletedBtn');
        const activeCount = document.getElementById('activeCount');
        const completedCount = document.getElementById('completedCount');
        
        // Time tracking elements
        const timeBlockDesc = document.getElementById('timeBlockDesc');
        const startTime = document.getElementById('startTime');
        const endTime = document.getElementById('endTime');
        const timeBlockNotes = document.getElementById('timeBlockNotes');
        const durationDisplay = document.getElementById('durationDisplay');
        const addTimeBlockBtn = document.getElementById('addTimeBlockBtn');
        const timeBlocksList = document.getElementById('timeBlocksList');
        const totalTrackedTime = document.getElementById('totalTrackedTime');
        const exportBtn = document.getElementById('exportBtn');
        
        // Auth elements
        const loginBtn = document.getElementById('loginBtn');
        const signupBtn = document.getElementById('signupBtn');
        const userProfile = document.getElementById('userProfile');
        const userAvatar = document.getElementById('userAvatar');
        const userName = document.getElementById('userName');
        const logoutBtn = document.getElementById('logoutBtn');
        
        // Modal elements
        const confirmModal = document.getElementById('confirmModal');
        const modalMessage = document.getElementById('modalMessage');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const cancelModalBtn = document.getElementById('cancelModalBtn');
        const confirmModalBtn = document.getElementById('confirmModalBtn');
        
        // Auth modal elements
        const authModal = document.getElementById('authModal');
        const authModalTitle = document.getElementById('authModalTitle');
        const closeAuthModalBtn = document.getElementById('closeAuthModalBtn');
        const authForm = document.getElementById('authForm');
        const authName = document.getElementById('authName');
        const authEmail = document.getElementById('authEmail');
        const authPassword = document.getElementById('authPassword');
        const authPasswordConfirm = document.getElementById('authPasswordConfirm');
        const nameField = document.getElementById('nameField');
        const passwordConfirmField = document.getElementById('passwordConfirmField');
        const submitAuthBtn = document.getElementById('submitAuthBtn');
        const googleAuthBtn = document.getElementById('googleAuthBtn');
        const authToggleBtn = document.getElementById('authToggleBtn');
        const authToggleText = document.getElementById('authToggleText');
        
        // Toast elements
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        const closeToastBtn = document.getElementById('closeToastBtn');
        
        // App State
        let tasks = [];
        let timeBlocks = [];
        let currentFilter = 'all';
        let pendingAction = null;
        let isLoginMode = true;
        
        // Initialize the app
        function init() {
            // Set default time values
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            startTime.value = `${hours}:${minutes}`;
            endTime.value = `${hours}:${minutes}`;
            
            // Load data from localStorage (temporary until Firebase integration)
            loadData();
            updateUI();
            
            // Set up event listeners
            setupEventListeners();
        }
        
        // Set up all event listeners
        function setupEventListeners() {
            // Task-related events
            addTaskBtn.addEventListener('click', addTask);
            taskInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') addTask();
            });
            
            clearCompletedBtn.addEventListener('click', () => {
                showConfirmModal('Are you sure you want to clear all completed tasks?', () => {
                    tasks = tasks.filter(task => !task.completed);
                    saveData();
                    updateUI();
                    showToast('Completed tasks cleared');
                });
            });
            
            // Time tracking events
            addTimeBlockBtn.addEventListener('click', addTimeBlock);
            startTime.addEventListener('change', calculateDuration);
            endTime.addEventListener('change', calculateDuration);
            exportBtn.addEventListener('click', exportData);
            
            // Filter events
            taskFilters.forEach(filter => {
                filter.addEventListener('click', () => {
                    currentFilter = filter.dataset.filter;
                    updateTaskFilters();
                    updateUI();
                });
            });
            
            // Modal events
            closeModalBtn.addEventListener('click', hideConfirmModal);
            cancelModalBtn.addEventListener('click', hideConfirmModal);
            confirmModalBtn.addEventListener('click', () => {
                if (pendingAction) pendingAction();
                hideConfirmModal();
            });
            
            // Auth modal events
            loginBtn.addEventListener('click', () => {
                isLoginMode = true;
                showAuthModal();
            });
            
            signupBtn.addEventListener('click', () => {
                isLoginMode = false;
                showAuthModal();
            });
            
            closeAuthModalBtn.addEventListener('click', hideAuthModal);
            authToggleBtn.addEventListener('click', toggleAuthMode);
            submitAuthBtn.addEventListener('click', handleAuthSubmit);
            googleAuthBtn.addEventListener('click', handleGoogleAuth);
            logoutBtn.addEventListener('click', handleLogout);
            
            // Toast events
            closeToastBtn.addEventListener('click', hideToast);
        }
        
        // Task functions
        function addTask() {
            const text = taskInput.value.trim();
            if (!text) return;
            
            const newTask = {
                id: Date.now().toString(),
                text,
                completed: false,
                createdAt: new Date().toISOString(),
                order: tasks.length
            };
            
            tasks.unshift(newTask);
            taskInput.value = '';
            saveData();
            updateUI();
            showToast('Task added');
        }
        
        function toggleTaskComplete(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                saveData();
                updateUI();
                showToast(task.completed ? 'Task completed' : 'Task marked incomplete');
            }
        }
        
        function deleteTask(taskId) {
            showConfirmModal('Are you sure you want to delete this task?', () => {
                tasks = tasks.filter(task => task.id !== taskId);
                saveData();
                updateUI();
                showToast('Task deleted');
            });
        }
        
        // Time block functions
        function calculateDuration() {
            const start = startTime.value;
            const end = endTime.value;
            
            if (!start || !end) return;
            
            const [startHours, startMinutes] = start.split(':').map(Number);
            const [endHours, endMinutes] = end.split(':').map(Number);
            
            let totalMinutes = (endHours * 60 + endMinutes) - (startHours * 60 + startMinutes);
            
            // Handle negative duration (crossing midnight)
            if (totalMinutes < 0) {
                totalMinutes += 24 * 60;
            }
            
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;
            
            durationDisplay.textContent = `${hours}h ${minutes}m`;
        }
        
        function addTimeBlock() {
            const description = timeBlockDesc.value.trim();
            const notes = timeBlockNotes.value.trim();
            const start = startTime.value;
            const end = endTime.value;
            
            if (!description) {
                showToast('Please enter a description');
                return;
            }
            
            if (!start || !end) {
                showToast('Please select start and end times');
                return;
            }
            
            // Calculate duration
            const [startHours, startMinutes] = start.split(':').map(Number);
            const [endHours, endMinutes] = end.split(':').map(Number);
            let totalMinutes = (endHours * 60 + endMinutes) - (startHours * 60 + startMinutes);
            
            // Handle negative duration (crossing midnight)
            if (totalMinutes < 0) {
                totalMinutes += 24 * 60;
            }
            
            if (totalMinutes <= 0) {
                showToast('End time must be after start time');
                return;
            }
            
            const newBlock = {
                id: Date.now().toString(),
                description,
                start,
                end,
                duration: totalMinutes,
                notes,
                date: new Date().toISOString().split('T')[0] // YYYY-MM-DD
            };
            
            timeBlocks.unshift(newBlock);
            saveData();
            updateUI();
            showToast('Time block added');
            
            // Reset form
            timeBlockDesc.value = '';
            timeBlockNotes.value = '';
            durationDisplay.textContent = '0h 0m';
        }
        
        function deleteTimeBlock(blockId) {
            showConfirmModal('Are you sure you want to delete this time block?', () => {
                timeBlocks = timeBlocks.filter(block => block.id !== blockId);
                saveData();
                updateUI();
                showToast('Time block deleted');
            });
        }
        
        // Export functions
        function exportData() {
            if (tasks.length === 0 && timeBlocks.length === 0) {
                showToast('No data to export');
                return;
            }
            
            let exportText = '=== TaskFlow Pro Export ===\n\n';
            
            // Add tasks
            exportText += '--- TASKS ---\n';
            if (tasks.length === 0) {
                exportText += 'No tasks\n\n';
            } else {
                tasks.forEach((task, index) => {
                    exportText += `${index + 1}. [${task.completed ? '✓' : ' '}] ${task.text}\n`;
                });
                exportText += '\n';
            }
            
            // Add time blocks
            exportText += '--- TIME BLOCKS ---\n';
            if (timeBlocks.length === 0) {
                exportText += 'No time blocks\n';
            } else {
                timeBlocks.forEach((block, index) => {
                    const hours = Math.floor(block.duration / 60);
                    const minutes = block.duration % 60;
                    exportText += `${index + 1}. ${block.start} - ${block.end} (${hours}h ${minutes}m): ${block.description}`;
                    if (block.notes) {
                        exportText += ` | Notes: ${block.notes}`;
                    }
                    exportText += '\n';
                });
            }
            
            // Calculate total tracked time
            const totalMinutes = timeBlocks.reduce((sum, block) => sum + block.duration, 0);
            const totalHours = Math.floor(totalMinutes / 60);
            const remainingMinutes = totalMinutes % 60;
            
            exportText += `\nTotal tracked time: ${totalHours}h ${remainingMinutes}m\n`;
            
            // Create download
            const blob = new Blob([exportText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `TaskFlow_Export_${new Date().toISOString().split('T')[0]}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('Data exported');
        }
        
        // UI Update functions
        function updateUI() {
            updateTaskList();
            updateTimeBlocksList();
            updateStats();
        }
        
        function updateTaskList() {
            // Filter tasks based on current filter
            let filteredTasks = [];
            if (currentFilter === 'all') {
                filteredTasks = [...tasks];
            } else if (currentFilter === 'active') {
                filteredTasks = tasks.filter(task => !task.completed);
            } else if (currentFilter === 'completed') {
                filteredTasks = tasks.filter(task => task.completed);
            }
            
            // Sort by order (for drag and drop)
            filteredTasks.sort((a, b) => a.order - b.order);
            
            // Update the task list UI
            if (filteredTasks.length === 0) {
                emptyState.classList.remove('hidden');
                taskList.innerHTML = '';
                taskList.appendChild(emptyState);
            } else {
                emptyState.classList.add('hidden');
                taskList.innerHTML = '';
                
                filteredTasks.forEach(task => {
                    const taskElement = document.createElement('div');
                    taskElement.className = `task-item flex items-center justify-between p-3 bg-white rounded-lg shadow-xs border border-gray-100 hover:shadow-sm transition-shadow cursor-move`;
                    taskElement.dataset.id = task.id;
                    taskElement.draggable = true;
                    
                    taskElement.innerHTML = `
                        <div class="flex items-center">
                            <button class="complete-btn mr-3 w-5 h-5 rounded-full border ${task.completed ? 'bg-indigo-500 border-indigo-500 text-white' : 'border-gray-300'}" 
                                    aria-label="${task.completed ? 'Mark as incomplete' : 'Mark as complete'}">
                                <i class="fas fa-check text-xs ${task.completed ? 'block' : 'hidden'}"></i>
                            </button>
                            <span class="${task.completed ? 'line-through text-gray-400' : 'text-gray-700'}">${task.text}</span>
                        </div>
                        <button class="delete-btn text-gray-400 hover:text-red-500 transition-colors" aria-label="Delete task">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    `;
                    
                    taskList.appendChild(taskElement);
                    
                    // Add event listeners to the new elements
                    const completeBtn = taskElement.querySelector('.complete-btn');
                    const deleteBtn = taskElement.querySelector('.delete-btn');
                    
                    completeBtn.addEventListener('click', () => toggleTaskComplete(task.id));
                    deleteBtn.addEventListener('click', () => deleteTask(task.id));
                    
                    // Drag and drop events
                    taskElement.addEventListener('dragstart', handleDragStart);
                    taskElement.addEventListener('dragover', handleDragOver);
                    taskElement.addEventListener('drop', handleDrop);
                    taskElement.addEventListener('dragend', handleDragEnd);
                });
            }
        }
        
        function updateTimeBlocksList() {
            if (timeBlocks.length === 0) {
                timeBlocksList.innerHTML = `
                    <div class="text-center py-8 text-gray-400">
                        <i class="fas fa-hourglass-half text-3xl mb-2"></i>
                        <p>No time blocks recorded yet</p>
                    </div>
                `;
            } else {
                // Filter today's blocks
                const today = new Date().toISOString().split('T')[0];
                const todaysBlocks = timeBlocks.filter(block => block.date === today);
                
                if (todaysBlocks.length === 0) {
                    timeBlocksList.innerHTML = `
                        <div class="text-center py-8 text-gray-400">
                            <i class="fas fa-hourglass-half text-3xl mb-2"></i>
                            <p>No time blocks for today</p>
                        </div>
                    `;
                    totalTrackedTime.textContent = '0h 0m';
                    return;
                }
                
                timeBlocksList.innerHTML = '';
                
                // Calculate total duration for today
                const totalMinutes = todaysBlocks.reduce((sum, block) => sum + block.duration, 0);
                const totalHours = Math.floor(totalMinutes / 60);
                const remainingMinutes = totalMinutes % 60;
                totalTrackedTime.textContent = `${totalHours}h ${remainingMinutes}m`;
                
                todaysBlocks.forEach(block => {
                    const hours = Math.floor(block.duration / 60);
                    const minutes = block.duration % 60;
                    
                    const blockElement = document.createElement('div');
                    blockElement.className = 'bg-white rounded-lg p-3 shadow-xs border border-gray-100';
                    blockElement.innerHTML = `
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="font-medium">${block.description}</div>
                                <div class="text-sm text-gray-500 mt-1">
                                    ${block.start} - ${block.end} • ${hours}h ${minutes}m
                                </div>
                                ${block.notes ? `<div class="text-sm mt-2 text-gray-600">${block.notes}</div>` : ''}
                            </div>
                            <button class="delete-block-btn text-gray-400 hover:text-red-500 transition-colors" aria-label="Delete time block">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </div>
                    `;
                    
                    timeBlocksList.appendChild(blockElement);
                    
                    // Add event listener to delete button
                    const deleteBtn = blockElement.querySelector('.delete-block-btn');
                    deleteBtn.addEventListener('click', () => deleteTimeBlock(block.id));
                });
            }
        }
        
        function updateStats() {
            const activeTasks = tasks.filter(task => !task.completed).length;
            const completedTasks = tasks.filter(task => task.completed).length;
            
            activeCount.textContent = activeTasks;
            completedCount.textContent = completedTasks;
        }
        
        function updateTaskFilters() {
            taskFilters.forEach(filter => {
                if (filter.dataset.filter === currentFilter) {
                    filter.classList.add('bg-indigo-500', 'text-white');
                    filter.classList.remove('text-gray-600', 'hover:bg-gray-100');
                } else {
                    filter.classList.remove('bg-indigo-500', 'text-white');
                    filter.classList.add('text-gray-600', 'hover:bg-gray-100');
                }
            });
        }
        
        // Drag and drop functions
        let draggedItem = null;
        
        function handleDragStart(e) {
            draggedItem = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.innerHTML);
        }
        
        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            const afterElement = getDragAfterElement(taskList, e.clientY);
            if (afterElement == null) {
                taskList.appendChild(draggedItem);
            } else {
                taskList.insertBefore(draggedItem, afterElement);
            }
        }
        
        function handleDrop(e) {
            e.preventDefault();
        }
        
        function handleDragEnd() {
            this.classList.remove('dragging');
            
            // Update task orders based on new positions
            const taskElements = Array.from(taskList.querySelectorAll('.task-item'));
            taskElements.forEach((element, index) => {
                const taskId = element.dataset.id;
                const task = tasks.find(t => t.id === taskId);
                if (task) {
                    task.order = index;
                }
            });
            
            saveData();
        }
        
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-item:not(.dragging)')];
            
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                
                if (offset < 0 && offset > closest.offset) {
                    return { offset: offset, element: child };
                } else {
                    return closest;
                }
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        
        // Auth functions
        function showAuthModal() {
            if (isLoginMode) {
                authModalTitle.textContent = 'Login';
                submitAuthBtn.textContent = 'Login';
                authToggleText.textContent = 'Don\'t have an account? ';
                authToggleBtn.textContent = 'Sign up';
                nameField.classList.add('hidden');
                passwordConfirmField.classList.add('hidden');
            } else {
                authModalTitle.textContent = 'Sign Up';
                submitAuthBtn.textContent = 'Sign Up';
                authToggleText.textContent = 'Already have an account? ';
                authToggleBtn.textContent = 'Login';
                nameField.classList.remove('hidden');
                passwordConfirmField.classList.remove('hidden');
            }
            
            // Reset form
            authName.value = '';
            authEmail.value = '';
            authPassword.value = '';
            authPasswordConfirm.value = '';
            
            authModal.classList.remove('hidden');
        }
        
        function hideAuthModal() {
            authModal.classList.add('hidden');
        }
        
        function toggleAuthMode() {
            isLoginMode = !isLoginMode;
            showAuthModal();
        }
        
        function handleAuthSubmit() {
            const email = authEmail.value.trim();
            const password = authPassword.value.trim();
            
            if (!email || !password) {
                showToast('Please fill in all fields');
                return;
            }
            
            if (!isLoginMode) {
                const name = authName.value.trim();
                const passwordConfirm = authPasswordConfirm.value.trim();
                
                if (!name) {
                    showToast('Please enter your name');
                    return;
                }
                
                if (password.length < 6) {
                    showToast('Password must be at least 6 characters');
                    return;
                }
                
                if (password !== passwordConfirm) {
                    showToast('Passwords do not match');
                    return;
                }
                
                // Simulate sign up (replace with Firebase auth)
                setTimeout(() => {
                    showToast('Account created successfully');
                    hideAuthModal();
                    simulateUserLogin({ email, name });
                }, 1000);
            } else {
                // Simulate login (replace with Firebase auth)
                setTimeout(() => {
                    showToast('Logged in successfully');
                    hideAuthModal();
                    simulateUserLogin({ email, name: 'User' });
                }, 1000);
            }
        }
        
        function handleGoogleAuth() {
            // Simulate Google auth (replace with Firebase auth)
            setTimeout(() => {
                showToast('Logged in with Google');
                hideAuthModal();
                simulateUserLogin({ email: 'user@gmail.com', name: 'Google User' });
            }, 1000);
        }
        
        function handleLogout() {
            // Simulate logout (replace with Firebase auth)
            showToast('Logged out successfully');
            simulateUserLogout();
        }
        
        function simulateUserLogin(user) {
            userProfile.classList.remove('hidden');
            loginBtn.classList.add('hidden');
            signupBtn.classList.add('hidden');
            
            userName.textContent = user.name;
            userAvatar.src = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.name)}&background=indigo&color=white`;
            
            // In a real app, you would initialize Firebase here and load user data
        }
        
        function simulateUserLogout() {
            userProfile.classList.add('hidden');
            loginBtn.classList.remove('hidden');
            signupBtn.classList.remove('hidden');
            
            // In a real app, you would sign out from Firebase here
        }
        
        // Modal functions
        function showConfirmModal(message, action) {
            modalMessage.textContent = message;
            pendingAction = action;
            confirmModal.classList.remove('hidden');
        }
        
        function hideConfirmModal() {
            confirmModal.classList.add('hidden');
            pendingAction = null;
        }
        
        // Toast functions
        function showToast(message) {
            toastMessage.textContent = message;
            toast.classList.remove('translate-y-10', 'opacity-0');
            toast.classList.add('translate-y-0', 'opacity-100');
            
            // Auto-hide after 3 seconds
            setTimeout(hideToast, 3000);
        }
        
        function hideToast() {
            toast.classList.add('translate-y-10', 'opacity-0');
            toast.classList.remove('translate-y-0', 'opacity-100');
        }
        
        // Data persistence functions
        function saveData() {
            // In a real app, this would save to Firebase
            localStorage.setItem('tasks', JSON.stringify(tasks));
            localStorage.setItem('timeBlocks', JSON.stringify(timeBlocks));
        }
        
        function loadData() {
            // In a real app, this would load from Firebase
            const savedTasks = localStorage.getItem('tasks');
            const savedTimeBlocks = localStorage.getItem('timeBlocks');
            
            if (savedTasks) {
                tasks = JSON.parse(savedTasks);
            }
            
            if (savedTimeBlocks) {
                timeBlocks = JSON.parse(savedTimeBlocks);
            }
        }
        
        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>